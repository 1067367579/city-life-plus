# 🏪 大众点评克隆项目 (DianPing Clone)

一个基于Spring Boot + Redis + MySQL的高性能本地生活服务平台，实现了用户管理、商户系统、评价系统、优惠券秒杀、社交功能等完整业务模块。

## 🎯 项目概述

本项目是一个功能完整的大众点评克隆应用，采用微服务架构设计，支持高并发场景下的优惠券秒杀、地理位置服务、社交互动等核心功能。项目展示了企业级分布式系统的最佳实践，包括分布式锁、消息队列、多级缓存等关键技术。

## 🏗️ 系统架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           前端应用层 (Frontend)                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                           API网关层 (API Gateway)                            │
├─────────────────────────────────────────────────────────────────────────────┤
│  Controller层  │  Service层  │  Mapper层  │  拦截器层  │  配置层          │
├─────────────────────────────────────────────────────────────────────────────┤
│                           Redis缓存层 (Distributed Cache)                    │
├─────────────────────────────────────────────────────────────────────────────┤
│  MySQL数据库层  │  RabbitMQ消息队列  │  OSS文件存储  │  邮件服务         │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 🛠️ 技术栈

### 后端技术
- **框架**: Spring Boot 3.0.1 + JDK 17
- **数据库**: MySQL 5.7 + MyBatis Plus 3.5.7
- **缓存**: Redis + Redisson 3.13.6
- **消息队列**: RabbitMQ
- **安全**: Spring AOP + 分布式锁
- **工具**: Hutool 5.7.17 + FastJSON2 2.0.51

### 部署与运维
- **容器化**: Docker支持
- **文件存储**: 阿里云OSS
- **邮件服务**: SMTP协议支持
- **监控**: 结构化日志系统

## 📊 业务功能模块

### 👥 用户管理模块
```
┌─────────────────────────────────────┐
│           用户管理模块               │
├─────────────────────────────────────┤
│ • 邮箱注册/登录                      │
│ • 验证码频率控制                     │
│ • 用户信息管理                       │
│ • 每日签到系统 (Redis Bitmap)       │
│ • 连续签到统计                       │
│ • Token自动续期                      │
└─────────────────────────────────────┘
```

### 🏪 商户系统模块
```
┌─────────────────────────────────────┐
│           商户系统模块               │
├─────────────────────────────────────┤
│ • 商户信息管理                       │
│ • 商户分类系统                       │
│ │   ├─ 美食                          │
│ │   ├─ KTV                          │
│ │   ├─ 丽人·美发                     │
│ │   ├─ 结婚·摄影                     │
│ │   ├─ 健身·运动                     │
│ │   └─ 学习培训                      │
│ • 地理位置服务                       │
│ • 距离排序查询                       │
│ • 商户搜索功能                       │
└─────────────────────────────────────┘
```

### 📝 评价系统模块
```
┌─────────────────────────────────────┐
│           评价系统模块               │
├─────────────────────────────────────┤
│ • 博客/评价发布                      │
│ • 图片上传功能                       │
│ • 点赞系统 (Redis ZSet排行榜)       │
│ • 评论功能                           │
│ • 热点博客推荐                       │
│ • 个人博客管理                       │
└─────────────────────────────────────┘
```

### 🎫 优惠券系统模块
```
┌─────────────────────────────────────┐
│          优惠券系统模块              │
├─────────────────────────────────────┤
│ • 优惠券管理                         │
│ • 秒杀优惠券                         │
│ • 库存管理                           │
│ • 分布式锁防超卖                     │
│ • Lua脚本原子操作                    │
│ • RabbitMQ异步处理                  │
└─────────────────────────────────────┘
```

### 🤝 社交功能模块
```
┌─────────────────────────────────────┐
│           社交功能模块               │
├─────────────────────────────────────┤
│ • 关注/取关功能                      │
│ • 共同关注查询                       │
│ • 朋友圈时间线                       │
│ • 滚动分页查询                       │
│ • 社交推荐算法                       │
└─────────────────────────────────────┘
```

## 🔥 核心功能实现

### 1. 分布式锁实现
```java
// 基于Redis的分布式锁
public class SimpleRedisLock implements ILock {
    private static final String ID_PREFIX = UUID.randomUUID().toString(true) + "-";
    private static final DefaultRedisScript<Long> UNLOCK_SCRIPT;
    
    static {
        UNLOCK_SCRIPT = new DefaultRedisScript<>();
        UNLOCK_SCRIPT.setLocation(new ClassPathResource("unlock.lua"));
        UNLOCK_SCRIPT.setResultType(Long.class);
    }
}
```

### 2. 秒杀系统优化
```lua
-- 秒杀验证Lua脚本 (seckill.lua)
-- 1. 验证用户是否已下单
-- 2. 验证库存是否充足  
-- 3. 原子性扣减库存
-- 4. 发送消息队列异步处理
```

### 3. Redis高级缓存策略
```java
// 逻辑过期缓存策略
public <R,ID> R getWithLogicalExpire(String keyPrefix, ID id, Class<R> clazz, 
    Function<ID,R> getFromDB, Long expireTime, TimeUnit timeUnit) {
    // 解决缓存穿透、雪崩、击穿问题
}
```

### 4. 地理位置服务
```java
// 基于Redis Geo的附近商户查询
public Result queryShopByType(Integer typeId, Integer current, Double x, Double y) {
    // GEOADD 添加坐标
    // GEORADIUS 查询附近商户
    // 按距离排序返回结果
}
```

## 🏗️ 数据库设计

### 核心实体关系
```
用户(User) 1:N 评价(Blog) 1:N 评论(BlogComments)
用户(User) 1:N 优惠券订单(VoucherOrder)
用户(User) N:M 用户(Follow) 关注关系
商户(Shop) 1:N 优惠券(Voucher) 1:1 秒杀券(SeckillVoucher)
商户(Shop) N:M 商户类型(ShopType)
评价(Blog) N:M 用户(User) 点赞关系
```

### 关键表结构
- **tb_user**: 用户基本信息
- **tb_user_info**: 用户扩展信息
- **tb_shop**: 商户信息
- **tb_blog**: 评价/博客内容
- **tb_voucher**: 优惠券信息
- **tb_voucher_order**: 优惠券订单
- **tb_follow**: 关注关系

## ⚡ 性能优化

### 1. 缓存策略
- **多级缓存**: 应用层缓存 + Redis分布式缓存 + MyBatis缓存
- **缓存穿透**: 空值缓存 + 布隆过滤器
- **缓存雪崩**: 随机过期时间 + 逻辑过期
- **缓存击穿**: 互斥锁 + 逻辑过期

### 2. 数据库优化
- **索引优化**: 复合索引 + 覆盖索引
- **查询优化**: 分页查询 + 延迟加载
- **连接池**: HikariCP高性能连接池

### 3. 并发优化
- **分布式锁**: Redis + Redisson双重保障
- **原子操作**: Lua脚本保证原子性
- **异步处理**: RabbitMQ解耦削峰

## 🔒 安全设计

### 1. 认证授权
- **Token认证**: JWT + Refresh Token机制
- **权限控制**: 基于拦截器的权限验证
- **会话管理**: ThreadLocal存储用户上下文

### 2. 防护措施
- **频率限制**: 验证码发送频率控制
- **SQL注入**: MyBatis Plus参数化查询
- **XSS防护**: 输入验证 + 输出编码

### 3. 数据安全
- **密码加密**: BCrypt强哈希算法
- **敏感信息**: 配置文件脱敏处理
- **传输安全**: HTTPS协议支持

## 📈 系统监控

### 1. 日志系统
```java
// 统一异常处理
@RestControllerAdvice
public class WebExceptionAdvice {
    @ExceptionHandler(RuntimeException.class)
    public Result handleRuntimeException(RuntimeException e) {
        log.error("系统异常: {}", e.getMessage(), e);
        return Result.fail("服务器异常");
    }
}
```

### 2. 性能指标
- **响应时间**: Redis < 1ms, SQL < 100ms
- **并发能力**: 支持1000+并发用户
- **可用性**: 99.9%系统可用性

## 🚀 部署方案

### 1. 单机部署
```bash
# 启动Redis
redis-server

# 启动RabbitMQ
docker run -d --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3-management

# 启动应用
mvn spring-boot:run
```

### 2. 集群部署
- **负载均衡**: Nginx反向代理
- **Redis集群**: 哨兵模式 + 分片集群
- **数据库**: 主从复制 + 读写分离

## 📊 业务流程图

### 用户登录流程
```
用户请求 → 参数校验 → 验证码验证 → 用户信息查询 → Token生成 → 缓存用户信息 → 返回结果
```

### 秒杀下单流程
```
用户请求 → 库存验证(Lua) → 分布式锁 → 订单创建 → 消息队列 → 异步处理 → 结果返回
```

### 商户查询流程
```
位置信息 → 缓存查询 → 地理计算 → 距离排序 → 分页处理 → 结果缓存 → 返回前端
```

## 🎯 项目亮点

### 1. 企业级架构
- **分层架构**: 清晰的责任分离
- **设计模式**: 策略模式、模板方法、工厂模式
- **代码规范**: 统一的编码标准和注释规范

### 2. 高性能设计
- **Redis优化**: 多级缓存 + 分布式锁
- **数据库优化**: 索引优化 + 连接池
- **并发优化**: 异步处理 + 原子操作

### 3. 分布式特性
- **高可用**: 故障转移 + 重试机制
- **可扩展**: 水平扩展 + 负载均衡
- **一致性**: 最终一致性 + 补偿机制

### 4. 业务完整性
- **功能丰富**: 完整的O2O业务闭环
- **用户体验**: 流畅的交互设计
- **数据洞察**: 用户行为分析能力

## 📚 学习价值

### 技术成长
- **分布式系统**: 掌握分布式锁、消息队列、缓存一致性
- **性能调优**: 学会数据库优化、缓存策略、并发处理
- **架构设计**: 理解分层架构、微服务、高可用设计

### 业务理解
- **O2O模式**: 深入理解本地生活服务业务
- **电商系统**: 掌握秒杀、优惠券、订单管理
- **社交系统**: 理解关注关系、信息流、互动机制

## 🔧 技术文档

### API文档
- **接口规范**: RESTful API设计
- **状态码**: 统一的响应状态码
- **错误处理**: 统一的异常处理机制

### 数据库文档
- **表结构**: 完整的数据库设计文档
- **索引设计**: 详细的索引优化说明
- **数据字典**: 完整的字段说明

## 🤝 贡献指南

### 开发规范
1. 遵循Spring Boot开发规范
2. 统一的代码格式和注释
3. 完善的单元测试覆盖
4. 详细的API文档说明

### 提交规范
```
feat: 新功能开发
fix: 问题修复
docs: 文档更新
style: 代码格式
refactor: 代码重构
test: 测试用例
```


**⭐ 如果这个项目对你有帮助，请给个Star支持一下！**

*🎉 持续更新中... 项目正在不断完善和优化中，敬请期待更多新功能！*